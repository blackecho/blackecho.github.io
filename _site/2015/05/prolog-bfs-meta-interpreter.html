<!DOCTYPE html>
<html class="t-green">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>A Breadth-First Search (BFS) Prolog meta-interpreter</title>
  <meta name="description" content="Today we will build a meta-interpreter for Prolog that uses a Breadth-First search strategy. The Prolog built-in interpreter uses DFS by default to build the...">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?">

  <link href='https://fonts.googleapis.com/css?family=Roboto:400,400italic,700|Roboto+Mono:400,500' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://www.gabrieleangeletti.com/2015/05/prolog-bfs-meta-interpreter">
  <link rel="alternate" type="application/rss+xml" title="Gabriele Angeletti" href="http://www.gabrieleangeletti.com/feed.xml">
</head>

  <body>
    <nav class="c-navigation is-fixed">
  <div class="c-navigation__container u-container">
    <a class="c-navigation__item " href="/">Home</a>
    <a class="c-navigation__item " href="/posts/">Posts</a>
    <a class="c-navigation__item " href="/about-me/">About Me</a>
    <a class="c-navigation__item " href="/about-blog/">About this blog</a>
  </div>
</nav>


    <article class="c-article">
  <header class="c-header c-article__header">
    <div class="u-container">
      <h1 class="c-header__title">A Breadth-First Search (BFS) Prolog meta-interpreter</h1>
    </div>
  </header>

  <div class="c-article__main">
    <p>Today we will build a meta-interpreter for Prolog that uses a Breadth-First search strategy. The Prolog built-in interpreter uses DFS by default to build the tree of computations. This is due to performance reasons, because other searching policies wouldn’t be feasible, except for fairly easy problems. But a cool fact about Prolog is that code and data are basically the same thing, and because of that its easy to implement a Prolog program that runs other Prolog programs (i.e. a meta-interpreter).
We can build meta-interpreters to change the behavior of our interpreter: we can for example change the search policy, do the occur check, return the depth of the computations tree, and many other things.</p>

<p>In this post we will change Prolog’s search strategy from DFS to BFS, as an example of how we can easily change its behavior.
The main difference between DFS and BFS is that DFS uses a Stack to mantain the list of nodes to visit, and it means that DFS always tries to expand the last node it has visited. This policy can turn into trouble if there is a
left recursion, which is when a variable that appears in the head of a rule also appears in the first goal of the tail. Since Prolog doesn’t do the occur check, which is needed exactly to avoid such situations, it loops forever, until it goes out of local stack.</p>

<p>With Breadth-First Search such situations can be avoided, because BFS will expand all the goals in a clause, instead of keep trying to expand the first node it encounter.
This is due do the fact that BFS uses a Queue to mantain the list of nodes to visit, so it when it expands a node, it won’t visit what it has just expanded, but it will continue to visit the other nodes it hasn’t expanded yet.</p>

<p>So at each depth level, BFS will first visit all the nodes at that level, and then move to the next level. While this is bad for performance, because we don’t want any useless path to be visited, it can always find a solution if it exists, thus BFS is sound and complete. Let’s now implement the meta-interpreter.</p>

<h2 id="code">Code</h2>
<p>We will use Prolog’s built-in predicate clause/2.
clause(Goal, Body) unifies Body with the bodies that matches with Goal, and return them in the form (FirstGoal, OtherGoals), where OtherGoals can be another list of the form (FirstGoal, OtherGoals). So clause/2 will find for us all the matches with Goal. Now we need a predicate that converts goal lists of this form into a standard prolog list with square brackets. To do this we will implement the predicate conj_goals_2_list.
Now we are ready to implement the meta-interpreter. Basically BFS is the same as DFS except that it uses a Queue instead of a Stack. The Queue works with a FIFO (first-in first-out) policy, so we always insert element at the last position of the list, and we always retrieve elements at the first position.
In Prolog we can do this pretty easily by using the way it handles lists and append/3.
Using the predicate append(OldList, Element, NewList), NewList will be the result of adding Element at the end of OldList.
So the code looks like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>solveBFS([Goal|Rest]) :- % list of goals to prove
</code></pre>
</div>

<p>we use clause/2 on the first element of the goals list, that is the first-out part of FIFO</p>

<div class="highlighter-rouge"><pre class="highlight"><code>clause(Goal, Body)
</code></pre>
</div>

<p>we convert the list format returned by clause into a standart Prolog list</p>

<div class="highlighter-rouge"><pre class="highlight"><code>conj_goals_2_list(Body, List)
</code></pre>
</div>

<p>we append List to the end of Rest, that is the part first-in part of FIFO</p>

<div class="highlighter-rouge"><pre class="highlight"><code>append(Rest, List, New)
</code></pre>
</div>

<p>we call recursively the solver passing it the new list. The program will keep trying to prove the goals, until all the goals are proved, or they can’t be proved</p>

<div class="highlighter-rouge"><pre class="highlight"><code>solveBFS(New)
</code></pre>
</div>

<p>The full code is available at <a href="http://github.com/blackecho/prolog-programs">github</a>.</p>

<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/

var disqus_config = function () {
this.page.url = "http://www.gabrieleangeletti.com/2015/05/prolog-bfs-meta-interpreter"; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = "A Breadth-First Search (BFS) Prolog meta-interpreter"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//gabrieleangeletti.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


  </div>
</article>


    <footer class="c-footer">
  <div class="u-container c-footer__container">
    <p>&copy; Gabriele Angeletti 2016</p>
    <p>
      <a href="https://twitter.com/gabrieleang">Twitter</a>
      <a href="https://github.com/blackecho">Github</a>
      <a href="https://medium.com/@gabrieleang">Medium</a>
      <a href="https://www.quora.com/profile/Gabriele-Angeletti">Quora</a>
      <a href="https://www.linkedin.com/in/gabriele-angeletti-71959a63">LinkedIn</a>
    </p>
  </div>
</footer>


    <!-- Javascript sources - placed at the end of the document so the pages load faster -->

<!-- JQuery -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<!-- Mathjax configuration with single dollar sign delimiters -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<!-- MathJax -->
<script type="text/javascript" src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!-- Cookie -->
<script>
document.cookie="analytics-filter-spam=myblog2016; expires=Sun, 18 Dec 2016 12:00:00 UTC";
</script>

<!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41410147-2', 'auto');
  ga('send', 'pageview');

  // custom dimentsion analytics-filter-spam
  var dimensionValue = '';
  ga('set', 'dimension1', dimensionValue);

</script>

  </body>
</html>
